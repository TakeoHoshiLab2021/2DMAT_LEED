``sxrd`` ソルバー
***********************************************

``sxrd`` は ``calc_sxrd`` を用いて原子位置 :math:`x` や原子の占有率、デバイワラー因子を与えることで Rocking curve を計算し、
実験で得られた Rocking curve からの誤差を :math:`f(x)` として返す ``Solver`` です。

前準備
~~~~~~~~~~~~

あらかじめ ``calc_sxrd`` をインストールしておく必要があります。

T.B.A.

``py2dmat`` を実行する前にあらかじめバルクデータを作成しておきます(フォーマットについては、後述のソルバー用補助ファイルをご覧ください)。
``calc_sxrd`` は ``py2dmat`` から呼び出されます。

入力パラメータ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``solver`` セクション中のサブセクション
``config``, ``post``, ``param``, ``reference`` を利用します。

[``config``] セクション
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- ``calc_sxrd_exec_file``

  形式: string型

  説明: ソルバー ``calc_sxrd`` へのパス

- ``bulk_struc_in_file``

  形式: string型

  説明: バルク構造のインプットファイル。

- ``struc_in_file``

  形式: string型

  説明: 表面構造のインプットファイル。


[``param``] セクション
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
本セクションは最適化したい原子の個数分定義を行う。

- ``name``

  形式: string型 (重複可)

  説明: 最適化する原子の名前。

- ``pos_center``

  形式: list型

  説明: 原子の中心座標。[:math:`x_0, y_0, z_0`]の形式で記載する(:math:`x_0, y_0, z_0` はfloat)。

- ``DWfactor``

  形式: float型

  説明: デバイワラー因子(単位は :math:`\AA^{2}` )。

- ``occupancy``

  形式: float型 (default: 1.0)

  説明: 占有率。

- ``displace_vector`` (省略可)

  形式: listのlist型

  説明: 原子を動かす方向を定義するベクトル。最大3方向まで指定可能。
       各リストで変位ベクトルと初期値を[:math:`D_{i1}, D_{i2}, D_{i3}, l_{i0}` ]のようにして定義する(:math:`D_{i1}, D_{i2}, D_{i3}, l_{i0}` はfloat)。
       与えられた情報に従い、
       :math:`dr_i = (D_{i1} \vec{a} + D_{i2} \vec{b} + D_{i3} \vec{c}) * l_{i}` 
       のように:math:`l_i` を変位させる( :math:`\vec{a}, \vec{b}, \vec{c}` は ``bulk_struc_in_file`` もしくは ``struc_in_file`` で指定された入力ファイルに記載された単位格子ベクトルを表す。)。 :math:`l_i` の初期値は :math:`l_{i0}` で与えられ、記載を省略した場合には :math:`0` が初期値として入る。
       
- ``opt_DW`` (省略可)

  形式: list型

  説明: デバイワラー因子を変化させる場合のスケールと初期値を与える。
       [scale, initial]のようにして定義する。initialを省略する場合は1が定義される。

- ``opt_occupancy``

  形式: bool型 (default: false)

  説明: 占有率を変化させるためのフラグ。


[``reference``] セクション
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- ``f_in_file``

  形式: string型

  説明: ターゲットとするロッキングカーブのインプットファイルへのパス。


ソルバー用補助ファイル
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``bulk_struc_in_file``


ターゲット参照ファイル
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

ターゲットにするデータが格納されたファイル ``f_in_file`` を指定します。
T.B.A.


出力ファイル
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``sxrd`` では、 計算時に出力されるファイルが、
ランクの番号が記載されたフォルダ下にある ``Log%%%%%`` フォルダに一式出力されます。
ここでは、 ``py2dmat`` で独自に出力するファイルについて説明します。

``stdout``
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
``sxrd`` が出力する標準出力が記載されています。

以下、出力例です。

.. code-block::

   T.B.A.

