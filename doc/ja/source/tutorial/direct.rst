順問題
========

ここでは、反射高速(陽)電子回折(RHEED, TRHEPD)の強度計算をするプログラムの実行について説明します(A. Ichimiya, Jpn. J. Appl. Phys. 22, 176 (1983); 24, 1365 (1985)).
最初に、表面構造のバルク部分に関する計算を ``bulk.exe`` により実行します。表面構造の表面部分を計算実行する ``surf.exe`` では ``bulk.exe`` で得られた結果を用います。したがって、 ``surf.exe`` を用いて原子構造などを決定する ``minsearch``, ``mapper_mpi`` でも必要となります。以下、 ``bulk.exe`` 及び ``surf.exe`` に関する使用方法を記載します。

計算実行
~~~~~~~~~~

まず、TRHEPDのフォルダに移動します(以下、本ソフトウェアをダウンロードしたディレクトリ直下にいることを仮定します)。

.. code-block::

   cd src/TRHEPD

次に実行ファイル ``bulk.exe``  がない場合には、以下のコマンドで実行ファイルを作成します。

.. code-block::

   make

makeが成功すると、 ``bulk.exe`` 及び  ``surf.exe`` が作成されます。
		
次に、実行用のフォルダを作成し、そのフォルダに移動します。
ここではフォルダ名をworkとします。

.. code-block::

   mkdir work
   cd work

必要なファイルをコピーします。
最初にbulk.exeとsampleフォルダにあるSiの座標データbulk.txtをworkフォルダにコピーします(bulk.txtの詳細については、花田先生のマニュアル(リンクを貼る)を参考にしてください)。

.. code-block::

   cp ../bulk.exe .
   cp ../../../sample/original/bulk/bulk.txt .

workディレクトリ内でbulk.exeを実行します。

.. code-block::

   ./bulk.exe

上記実行時に、以下のように出力されます。

.. code-block::

   0:electron 1:positron ?
   P
   input-filename (end=e) ? :
   bulk.txt
   output-filename :
   bulkP.b

実行後に、ファイルbulkP.bが生成されます。


続いて、surf.exeを実行します。
最初にsurf.exeとsampleフォルダにあるSiの座標データsurf.txtをworkフォルダにコピーします(surf.txtの詳細については、花田先生のマニュアル(リンクを貼る)を参考にしてください)。

.. code-block::

   cp ../surf.exe .
   cp ../../../sample/original/surf/surf.txt .

workディレクトリ内でsurf.exeを実行します。

.. code-block::

   ./surf.exe

上記実行時に、以下のように出力されます。

.. code-block::

   bulk-filename (end=e) ? :
   bulkP.b
   structure-filename (end=e) ? :
   surf.txt
   output-filename :
   surf-bulkP.md
   surf-bulkP.s

実行後に、ファイルsurf-bulkP.md、surf-bulkP.s
及びSURF(年月日)-(時分秒)log.txtが生成されます。
(年月日、時分秒には実行時間に対応した数字が入ります)

計算結果の可視化
~~~~~~~~~~~~~~~~~

surf-bulkP.sは以下の通りです。

.. code-block::

   #azimuths,g-angles,beams
   1 56 13
   #ih,ik
   6 0 5 0 4 0 3 0 2 0 1 0 0 0 -1 0 -2 0 -3 0 -4 0 -5 0 -6 0
   0.5000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.1595E-01, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00,
   0.6000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.1870E-01, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00,
   0.7000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.2121E-01, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00,
   0.8000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.2171E-02, 0.1927E-01, 0.2171E-02, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00,
   0.9000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.4397E-02, 0.1700E-01, 0.4397E-02, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00,
   0.1000E+01, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.6326E-02, 0.1495E-01, 0.6326E-02, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00, 0.0000E+00,
   (以下略)

上記ファイルより、縦軸に角度（5行目以降の1列目データ）と(0,0)ピークの強度（5行目以降の8列目データ）から
ロッキングカーブを作成します。
Gnuplot等のグラフソフトを用いる事も出来ますが、ここでは、scriptフォルダにあるプログラムplot_bulkP.pyを用います。
以下のように実行して下さい。

.. code-block::

   cp ../../../script/plot_bulkP.py .
   python plot_bulkP.py

上記実行により、以下のようなplot_bulkP.pngが作成されます。


.. figure:: ../img/plot_bulkP.pdf

   Si(001)-2x1面のロッキングカーブ。

この00ピークの回折強度のデータに対し、コンボリューションを掛けたうえで規格化します。
surf-bulkP.sを準備して、make_convolution.pyを実行してください。


.. code-block::

   cp ../../../script/make_convolution.py
   python make_convolution.py

実行すると、以下のような数表convolution.txtができあがります。

.. code-block::

   0.500000 0.010818010
   0.600000 0.013986716
   0.700000 0.016119093
   0.800000 0.017039022
   0.900000 0.017084666
   （中略）
   5.600000 0.000728539
   5.700000 0.000530758
   5.800000 0.000412908
   5.900000 0.000341740
   6.000000 0.000277553

1列目が視射角、2列目がsurf-bulkP.sに書かれた00ピーク回折強度のデータに
半値幅0.5のコンボリューションを付加して規格化したものになります。

